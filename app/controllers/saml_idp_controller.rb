require "rexml/document"
require "rexml/xpath"

class SamlIdpController < ApplicationController
  include SamlIdp::Controller

  before_filter :validate_saml_request, only: :create

  #WELLPOINT_SAML_RESPONSE = "PFJlc3BvbnNlIHhtbG5zPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIERlc3RpbmF0aW9uPSJodHRwczovL3d3dy5xYTEubXlmaXRvcmJpdC5jb20vc2FtbC9jb25zdW1lIiBJRD0iXzFmYTMwYjNiOWFiNGZlMDdiYTMzZjU5YjUxNjdhMDljMzc1YyIgSXNzdWVJbnN0YW50PSIyMDEyLTExLTA5VDE5OjMyOjU0WiIgVmVyc2lvbj0iMi4wIj4NCiAgICA8bnMxOklzc3VlciB4bWxuczpuczE9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5zYW1sLnVhdC5hbnRoZW0uY29tOkZpdE9yYml0PC9uczE6SXNzdWVyPg0KICAgIDxTdGF0dXM+DQogICAgICAgIDxTdGF0dXNDb2RlIFZhbHVlPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6c3RhdHVzOlN1Y2Nlc3MiLz4NCiAgICA8L1N0YXR1cz4NCiAgICANCjxuczI6RW5jcnlwdGVkQXNzZXJ0aW9uIHhtbG5zOm5zMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PHhlbmM6RW5jcnlwdGVkRGF0YSB4bWxuczp4ZW5jPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyMiIFR5cGU9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI0VsZW1lbnQiPjx4ZW5jOkVuY3J5cHRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyN0cmlwbGVkZXMtY2JjIi8+PGRzOktleUluZm8geG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPg0KPHhlbmM6RW5jcnlwdGVkS2V5IHhtbG5zOnhlbmM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jIyI+PHhlbmM6RW5jcnlwdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI3JzYS0xXzUiLz48eGVuYzpDaXBoZXJEYXRhPjx4ZW5jOkNpcGhlclZhbHVlPlZhZis3amRVSjg3bEpWV1VPQjd6bHU3NFZtaHh6WmY3SmZyQmk4MEs2NUJwTHFvTmFSVFFmeDI4L3JyeldmTWlBbkVnd1lxc2Zjek0NCmphWjJWTUJBVmwrY1ZxTHhudXpNVndDbHhYWDlnQmtoMEI0U3NIYURiVDJqRmNNMEhFRnVoZXhWVnViSG9KVW1JYjZtcFJWSGtTbVANCjFjaFA2Z04zNmE4bU5vVmUzM1k9PC94ZW5jOkNpcGhlclZhbHVlPjwveGVuYzpDaXBoZXJEYXRhPjwveGVuYzpFbmNyeXB0ZWRLZXk+PGRzOlg1MDlEYXRhPg0KPGRzOlg1MDlDZXJ0aWZpY2F0ZT4NCk1JSUNZekNDQWN3Q0NRQ0xRN1g5U1A4MGlEQU5CZ2txaGtpRzl3MEJBUVVGQURCMk1Rc3dDUVlEVlFRR0V3SlZVekVMTUFrR0ExVUUNCkNCTUNRMEV4RkRBU0JnTlZCQWNUQzB4dmN5QkJibWRsYkdWek1SSXdFQVlEVlFRS0V3bEdhWFJQY21KcGRDQXhGREFTQmdOVkJBc1QNCkMwVnVaMmx1WldWeWFXNW5NUm93R0FZRFZRUURFeEZ4WVM1dGVXWnBkRzl5WW1sMExtTnZiVEFlRncweE1qRXdNRGt5TXpRNU5UZGENCkZ3MHpNakV3TURReU16UTVOVGRhTUhZeEN6QUpCZ05WQkFZVEFsVlRNUXN3Q1FZRFZRUUlFd0pEUVRFVU1CSUdBMVVFQnhNTFRHOXoNCklFRnVaMlZzWlhNeEVqQVFCZ05WQkFvVENVWnBkRTl5WW1sMElERVVNQklHQTFVRUN4TUxSVzVuYVc1bFpYSnBibWN4R2pBWUJnTlYNCkJBTVRFWEZoTG0xNVptbDBiM0ppYVhRdVkyOXRNSUdmTUEwR0NTcUdTSWIzRFFFQkFRVUFBNEdOQURDQmlRS0JnUURXTXAzRWs3UnMNCmJLbWZIcVlSZVpTNmxCQlQ4NXMzaEhSK3d5blpFeUxvbHhCZ1I2WEFyTytDZGdMM3J2SmJZR2RvNFlIdjUzd2hvajdvZStMcnFFaFMNCnV0ZSsySlZnQ3pTWUt0aFM0MWpTcTVvV2kycTdkcHdYMmxhUkcrS1lWVzUrUWxDUW5UUmREd09nOHhEeGx5d1lXZkYySFlxRUhCdlkNCitYamk0d0ZGUndJREFRQUJNQTBHQ1NxR1NJYjNEUUVCQlFVQUE0R0JBR0FkVXZjejFHdGkwUzBpK0ZFYkFCTklOaW5NMTZrZTZaNFcNCkxKODVjU3dxMzhVOGZpelYxd0hVd1ZSbWVHTWwvRFFTaVlNVFAzNXJjNndYMTRwdUttNGhUWVNUUzZ5OGVSOTIvZDlJNm5BdVJoakkNCm9XUlJ5bVgrd1kvZTZ1ZW9iUDRUdmE0VEUrOWVQOVRPd0Nac1QxaGRCUnJ3Smw1MnN1cGpLR1p4WGVyQQ0KPC9kczpYNTA5Q2VydGlmaWNhdGU+DQo8L2RzOlg1MDlEYXRhPg0KPC9kczpLZXlJbmZvPjx4ZW5jOkNpcGhlckRhdGE+PHhlbmM6Q2lwaGVyVmFsdWU+ZzJwUHJ5Nlo1bFo1UE42cmVFK0Npb0JtN0lDYlNXZ1R2YXdTbHhZUUpmZG9ZNmpmWnN4c21jMzRqUEZRYStIOWJ0bjlvdlo4a2p6dQ0KRVNaMXhDVXl5OUoxeWJNUmZCR1RGckZTTDJiRmdrL2hOZU13VlNrQk8zS1pmTUJDcDZhZUI5WkZwOGFBOGFKQXVUbXdEVlIwN3p0RQ0Ka3F6VmtXalhZRmc2OWRYM05WaytxSExrNStDN1plRitWUysxdWk1VEJtUS9LbU9HanBZblg5SDUwVDBYWXhaTlFWeVRZa3YvcUF6QQ0KYk5SdnhGTUNtbVJuZkVzSlVoM1BmR2xvSzJhd3poYVlNSWFKWFE3Um5RdThIMmxGRkNyOTRSZ01ISmJJVVhVcXNReldZM2lNVStFNw0KTWVsdW5Nb0Fyck80ZlhEcTFyaVlkNjFhajREbExVSGttQlRCOE0wUkljNVRONUgwaUM3dzF0V1hqek95MERGcjNEUVdseGE2QndmZg0KVkdvMVI5QnFXTytBYUw4dFAwNWR6MUVOWU1JN292TUpYNkRFNWpRODIyYTdaZFkwUW91UE9TOW83bHZudEdXb3Z2aUVFY3NsclVvUA0KZ0pJU3dnaVpwN3h0UDMvWDNqY29yVGw3cEJJb1pHNDhKOTFpUXAzQnNuNEExRHZuY2hRa00wK3VXTmJ1VUdFUXJia2RxZzlqUmczLw0KQ2g4bUFZc2laRUZoQXE2TFlKYmpNaC9KSExEMjZta2xtMGdzWUdKYjBUd2VXa0svWnpTSlhNc2kwVm9meG04V0x2eVQyeHM4S3BlRw0KZTNkekJ2a1JyVkVaZFo1OU9KamkwTVVENHMrVmlVZER6a1B4a0l3QWVNc01XeldIbmx4VkxXODJMWGZyemdtSlZGdmtFM2JJdlphWA0Kbk12V1RYeFgrdmRpOGY3WHVmenNQcWx5ZjQ2aTVnRE5xQmlvbGRyQmJnL0xQOGhNOEk2VFphYUk4UUtEcVZZN2J4akxvdU9qSFVPZA0Kakwyako2QlBRcWtlWGZDU3hHMmRyZnlkYVNXSmtYSWptaUdTZkREOXZmNFBBT2NrV3JDbmdZTjFyMjREOVpHejhUaTQ0UTNQQlB3TA0KZDZiUTd3MlNVVWtaVThsZHZpQ1ROWHdkVEVod3pmOHliVnFFdXFoQUplckpZMENoYXVhVE0yMStYZzZ6bElVajZjdG5NLzFtQTVkOA0KakRxTmRHd1dvcXdyR3F1MHcwSEh6KzY2d0N5cVdwS2J1UEFvbnpwU2J2dTJ5elpFSEJuK0RsQjBVN2JuRy9OOUpQQ0ZCSG05WUMwVg0KM1FTc3kvN0E4U3NNckJPenphZEc5eUg2THpnL05sNG4xK0E0VXIwem5EOGdQKzFhRHQ3eUxScmNWd2N1eEl1V3dFTGVqSWNXeUZZQQ0KS2lIaDRlMWsvOFZ5WXpRU3BHTDFxRC9QNWJXVkNacDdMejBXbTJ6YkJ1elpSQ3JoM1FkKzhYY1J4clNONXl4UERHcllrVlpjeXcyYg0KWjJ1dUo4T016eWNVbk11Z25sazMxdzB4ZVNoRUc2dFBoQlBvdVRzZk9PY3BOb0ZiNUxOQnNSbE1jNFZVR2VERXJzTmxXNCtheHJNMw0Kcm9wR3J2M04xaVdJWFF5dm1tbjlqNVJDanJTYXRHZjhKaGhiWmEwdmV4c0pvL2JMWVY1L3Z2eW85aDZWaWJ2emRLMi9DaUp1UjdLMw0Ka0tyTGNoaWsrckVXVXZBSndyMTBJMitkejRTblBFbGNQRDV2TWlVNEpyVHRZelN2dndZVW1FbzdOM3h6dnJweHNZZ2p2eEdZNkcwaw0KWXpjcDNsYnhaaTNPRHIxTWR1QlI4NlRGaUpVenNhdUtaMzhYT0hBZ1Q2WCs4N29pbjA1cklwdFZjSVFzSWQ3Y2cyVlc3bWMwMVh6Nw0KR1RMNU40ZXJrNXczQTNRU3FZUU1PZ0YxRnRkalRrNGVHbUFrTk5lTDV1Vzl1K1dmVkQxajV4dkZVOFZUWW9kakxmSzhwOHJkNWwyNA0KQ0twVVJKSkpjNlovY0ZLeklIWGxrUm5qMVFrWlZ5T0FDTjNZdHNxczFEdFhTd3Evc0x2RzZTWVA0a2V5L3crUWlQSk4wc3dQc3YvcQ0KVkZyNUU5Z0x2ZHViTC93MnZvS0NRYWJLeHUxWTA2NVZnVGxxL20ra3lCN3R5VWFtM3I4UEx4RExRVGxmOUl4OUczN2M3Z3o1VjN2bw0KUXcyYTIvZFVYM1N5WGNIL2E2dnU5dlNKbU5aSXV0WFYyY21NUHlLdTBaM004Mk9FUFNuZGRyVHQvS2tCZlkwSmxKRDVwTHlpaTlaUg0KbnZmaG1xT3lDUjhUYzZ5RkEvaUZ2MFZpRFZyZmZCc1ZBRFhXWVVCSVlCRHU5Z3RCR1lhUTZlcDlnWVllS1U2cytLcjJ2bnBxRUJLWA0KaGFpb2xLNzRCaVB5ZVFteWxEWlluaHJUSnBteDU0Yi9YalpiK2N5ejBVeTF5dE8wMXpOMlhobVdyT2ltUUZtYktZWkc2cWlxZktlZQ0KbXoxOGl4Q3lxMzRkb3kybW5Wa2NjeVI0eVp1Tkg5djJITUMrWDcvc3B5QzFVd1QxU3B1RHdZdG9pdnA5YlNHMWgwSUZ3T05sNHhGKw0KaENXN1NPQmdYNWJ5TmpaOVBqOWg5cUtQTFBEZW5GdXRsWUx4cGQ4cytsZXVtd09laWVjZTF4NVVKMkd5aWc5eWdBV0FCc0RnZGRabA0KZWNLa2tCM2FBZFJnWmtIbU5XSzJSYmxueFVGaFY4djgvVmFFRUZjQUgvdUFveTdGeVpOZlAxZ1VpV0lHYUpldTZjTE5KalkrcGFkWQ0Kc1Fva3c5UWcxcWFUWWw2NExQMjc2WVBMVng0QXBsdmRyMWl0Ni8vU1lmbk4xMzBMZ1VQS1dEQ1dDZ09rV0VaOXpvOEF5bzdOYzJDWQ0KOXI1WElRSkV1eVpTYXdmYUE4YWZNZ2RKOVdTNkFxMW5id2dUQ3BEUHJUQlVLcnZFcDdFY2ZaL01Ya2hCbElzRnFzK0N6bGtiWHZMbg0KZ2JtbXFsQTNOaU9LbmhzaXBNaldHWi95c0hKSHhtRHNFeHByTFJpNzVMTUNZbXB2cW8yRCtWaSsyUEZZbFdqY2k3bGFmLzMzNmVsUA0KQmRtREQxRjAwUXFBMWtDK3hqVCtqT2doUGY5ZmJFZTBveEx6eFB0eHdoSlRKWW5OK25mQW91UWFmdEJmTU5jUEpxMXFIZDFQZUdZVg0KOGFjWUlsMHBkZzk3amhCQmZTYjVEcEZTR3l3QXlFYzhVNmpFa1g4cnM5Y2VWQkt4VDR2ZHB6Qi9JN1g2OUVwQzhWWUE4d09HbS9IQQ0KWUhCQXZRaVVjbmErTEQyQmJPVWFQTHRsNXhkRGNXR3AydW5ZbWE0VEJGMGsxZTVtQjh2bkVKam5LS1k1cDNreXFLa2o4VFBlaW81cA0KQXNFWjJta0s0cmJUcC9PSm8xdUZ0OGhveG1PNkYralBrSGFlNXVIRVhzenZIamJzdmtvU3B4eXJENVU1RW0yeHY5ZFp0UVNlUzlzaw0KL1hhWGduUEJYRmVyNHYya0lTaFEyVEYySlROa2c2YWVWL1RZZ1R1U0IyNjE1VkNGeGFEWnkzUHlPQ2dMdFZSVUd4Q0hLZ2hTcWtqRw0KYkJYa29zOVdGaUpGS1I5NDAyM0Z0R0pVU3dvdmx3WVpZeWxGdEI5UEcrMXdGQzBOR0pINmVCekpwbmtEWldCUEFua2pvdmtJd1YyTw0KaUdWT2x3WEgxb1V2QURpNDFQdk5lelB6R2lTVHFsTUhKbmJSb21FREdUdmNxYlQ0Mkg5OE0zQ3JRQU4zaXYxVk54SXBiczExbXV6OA0KTHFwb290NnNnQUxzbTNnM1EyVmpLRjRhR293bmJXM3ZqVG1kc0ZNSGMrbWhvMVZMMnFZL1FNcDJSL1lkTTViU2s4K3JoaXdQRWN2Yg0KRjBvSSthQ2ZFRlBYZUI1bldvanRYK2RQZmNjWC85dG0rSFhCZWhYeVRUZlhiNW1EaWgxaVNpaGorTUZNenU4QUhNTGM0dVc0SU9qUA0KWU40aHBpZTdVWWpHd0lCY21xalE1VDMrWDhwczB0bTRya3UvTFNPbXZwRzZaQnhuR0IvM3l1SjF4N1M0RTJTQUpGN1NsQk1EeXlndA0KMmRmVFhDbG5iYkNPcC94akV1V1RCeVdxcWg0RjVicWZ5dnNMSzc3V0pFN2FxeU11ZGs0WTZKWEx5QlJONm80bGQ5S2MwQXlCMEZQZA0KOCtYaVZYcE9Qb3BJcmVudFFodEpSdXBvOHNqdW0zenk3YzV0bzMwcWdnVTZWZ1JuenE1RjZkRmRGTFBkNHk5OWhwLzczckJ0d2VHWA0KMTk5YnVMVWNMN1AvN0UvaGxtRFNSTnprdkNtU0lmakVVMzFITnRvM1lZWE0vdis4dGhqZElKMysrWTF1dmFVanNWSmUxUU1MNkpnbg0KNUovRFFEWDFNb2xHRU5URURocktnMkJUZkd3N0lzeEFmem9odTd4S0ZoOWFoTXEvK2tkVGIwUWgvajFuZ0tTdytxK3dDWWRjSTZTbg0KSHFYeVlrWmhCeWttYVpna1BCWG80UlNzWWZNVUVMN25GRzJsdlhlbzk0ZmlLMlNIQXZUMkh2TzNRbWF3TmFjQityOXJML0Z1TWxlbg0KWUJ4VGJRWG9nMnNMMlU2VWNPSGlBK1grYUV3VFRNTGh6T0pkWHBDM1h1SkNTVCs2SklUZTdLZVUzYk1MSGJ4Qm85OWEwOU1OVTMvaA0KeUQ3QzJ0U25PTEJDa3QxN05CRjM4ck9RZncwQWNvRTFXS1MzeWxXdWZtNktsakZEUThMa3FXSTdLRHRYL2FaL2hneUtBVGk1TDlyTw0KNHlFYmJRS3JidThqTHFnT1phTnRCNnRBTTlFeWVKdkJaRVFlMzJOeFVJV0RHNmdUTjdWaTlHSDdGemMyNk5NNDZwM2JXa2R0bzAyMQ0KeXNyenVVKzFxeFVlR3c0YTF1cHMyZUMwTS9WWHZZMXZabFltV0RPMGllSmhJNEMvMDlqcEhLc253TEJTUXM2UnhnbHdwZzZKd2NpUA0KV0RUbThYcTlndHhnUXNsVllKeWVVdGh4N2xHLzYvOW1qNmFVNWlCZjZzc3pPS0ZhNmE4TVJUVENFZ1RWL3VWSjFqdDFpNmpFNkpMRw0KN2Y3ZHlZZ2t5aUZmcDV4cmJYOGJTUWxobHZjVUhwUE5QdWh4a0wzYlk2SHRhU01za1R1WHBvL2ZGcmNiakU0bFJudVhGbU81OGhWTQ0KallycjRENXJ1Nm5UQmhtVmFpc3I3NDI0OVBFUnp1eFRXaXk1clZwdzBWWWRwTFJqVGlNYXV6bmlyTlFlZEs5RS94SGc0VzRNSzZQVg0KSHZWN0lVc1BNaE1xOWtpT2hZYzU3Y0xhREZEWCsyblhWVHg3QUgrVTRtcWVLNTNyVFVvSEc0ZmVreTl6aElodHdKTkxMRHV5U0U5VA0KT0x1WDNkTW9WTkd0cHhicTkzSFgvbVpRNHRPSXE4VDhnSTlTb2JzOUY4eXZMdEk0UHJTV3hKMTIxSFNKZURWZ0NXNWRRdGwxTEtmaw0KSURwREYwNm9XdVFiTy91bXRmZ2V2YU42RGhGRFZwT0tCWnc3cEpxcElIdkNYeW5uQ0h1c2plSm9iNVpsM3U2MGc3VzM5SmdnL1RZdg0KbEVUSXd0bFltYWNaU2NJSVh2RnlzNW5jLzZqb2tzU09YenZPUEZpencvZ29hdU5qVHl0dS84TS9CSGR4bmYxV01jZlo1MkJhaG8yQg0KOXZ0cGFWWWttSGVNVkw0aldINjlFNURLUS9nMG0xa0I3MXAvZ2JVZ213bTNMQ2loK1JGMG03dDFFUElOTmh4RThKNzlZSzlnVGhzUQ0KcVJwS0xaSEsxRFBpcFpwUS90RG1YQU9WR0JWUUx6cTVZNUkxNnNOY0hqWnJ5QWd1RWhXR2lWSzZEa0ZHMXBwRC91RFc1YkZUYWRPKw0KdHNJelp3cVhRTlZLRDR0UDBEd2k3am80QXdrWnhDdks1clR4OCtMcEpuekI5eGh6cW1XK21MdnJBMnF2YTlSby81M0lFY3c5WTNpLw0KTFdOOHB3NTZCQkRzL0hXWmYzOTMvWGFSQ0VFVDVrNWsvL292THk5aUtFTmlCU3lqSk9uRDMxdDVxcE1FdHVublBwRWtkTWNvUThMbw0KVk8vZ1A1Zy9CdFh5UzY5NDNUV1RrbWVzbGNSUkd3ZXJabE9aT3JDU1FIYkdtWjI5MTFOaURzMjNyZDVMYnNyY01ZUS94a1lTV0o4Yg0KMncrN0toVHlmakNTUVo2VVIyU05kVThta3o0a1djYXRhQVlPMXlIQzR5NitWdVVwN3E4T3ZpZTRJRmM1cURKbVROOXM0VG16NFRMZQ0Ka2U0aXlHWTN0YlhRNGJHTU9HRnZqWjBpY0lweVdzenNCbjNyWTJORzllaEo2aElBbG45OEdoV0lSK1dRN0FaZDV4bW9TdHdtc2lSbw0KRG1Gc0tiVHFGc0w1SlBSQ1NvODBlanhIeG04cVNzZnIydlcvdTZPcmtscXcvYlkrTXB0UmlNU3ZlVnM0d3NOb0xOZmw0dmNGT1hzSw0KaTNtNTd0Y2d1cTE0MG1qSXUrTGg1Z3RsRDROb2hsd2NuOWlrd3dhVlF3WWxHTFgzRmpWbnZPcGQ5VHlqOFZEd3ptU2tlR01RbWcraQ0KTEIwVFA2eG8zSmJXQjZhSlFiREJxMmxwaElaOStHQ2dMYlpMTy9UVTNNSEJBSU5ZNklmK2NZa0h0dVJUL1lyR2l2aVpWVmVOWUhTYQ0KbllyY0M3QjlCT3pobUJDd256QTk4NHJDOUtZL3R1MUdveTdwVk9PanpSMGpMVGhDSzBxR2d0L3lBKy9XSnVzdTBFT3FCYkNiZDVMYw0KblJXcDJLWkphTWF1WnI3cmJHNUMrS1BpQWZhZGFqOUFadzJyV2c3ZkJnUnNZVW9GRVlIR3pYQTdmUHlvZTFkWXQ5dDlPSkVJZ3NNSA0KL2pvSzJYSVBBbFNlUTJUeW1YZElKd0ExUTVtK2VDMVZDZ21FSDVWSGFxS01ibS8vU29TTHc1eUlRUXlNcVRtUXpPNm02b2pwUlBXWA0KT3BDYjJYQTZZdndPL0tOU1Q4TGdvMFFRU1hCV082UzUyc1R1QlkyNjIvRlBscFY3eVVZV3Y0QWtNSXlDZ0dnN05mdlUwMXdNdjFsdQ0KeW95QTh4bEo0WUZRdjc2aDMvSzBVMHBjNjFTWTJIaFJuQUV3bGx0MkpPT2IwOHhhdGt4SDVzd1JveFM5N0VWaDR3dklIcHNwRVZsOA0KcGlTRU4ramszZGQ4eCtDaThISWVaaE1GNWtjNHovb2lXaGs4UUg2cnpnVGlaeExQTW5iQ3VBUkh0TUZBN1lCaXRadTlhUXFyTDRsaw0KSjVxVFd3RFpJaEhxKzJ6VFhiTDhFTkR5OTdldHVlMndkeGR2OFU0STRoSGZWZUdLMUd0Z0Q5NFNrelp0bFl2enB0dlN5R3hnMmRBNQ0KT05IYXUweGpTbG4rK0VjVHNWbElSUFg5RDB6M2xDbWkrNEdvMGNuTVpvQ0ViMmh5UVhVWnZoNmw1QVpsbzRoMk41N0J0RFpaQk92dA0KdXZMcy9ZR04rZnc5NUdrSnhhNGwxNCtrV0V4Mmx4RFcwL1RHcVV4Yi9GdFVoSG44Ujg3S2Rtbkp5YWI0cmx5ZFJLU3hHQkRxcXl3Uw0KS3VDVE1WYmhkM2JQcnVPb3F3eG04U2FvcjdXOHJreXpLWkhLTWd3M28xbDMvMUJqUTkwTXdtYXV5bGxmaCtZR0F0NHFWNEhjY21wdQ0KeGhrZ0MrNlRsN0MvMlZiazdxZlFhZWxrTnp0Q0RMTkw5VVhiRnYyMHdpMnF6UDhXenJYRm95OUoyM21UVU1Hb3p2ZHhZVCs0UUUxUw0KTzl1OEIrM0xmWmhjUkhCeDJNSEFZNnNoWVdzU05FMUNwUVdzUEZydUdtS0xWOEkrSVRsaG1QVFU2Zi90RmR5MU9ZaDRmM2VTYnFSQw0KQUVRVW05WkRKbkR3UTBuS2NuQXR1aVZ1OUVjVlFvOXZCVVQ3c2IxOUp0V3gzSWtCYWwyMElxZ1l0Wm40RVlwTHVhaWVnWTFnWm5VUA0KYW5veXdqcHd3Umw4RTVMMktHRmxNY3p2QUpXcFFaaUtXOTFJZzhkZjVLUEJrNTB3VXFNUDFZRXNlYW41YU8vMGk3WVlqa3g1c1Zzdw0KT1dETXcyT0djYzRNb3Q2K0kwcmtJanFxN0xZcjQzdFAyN2hqbXVNdWpvVDNOZXdXc0p1cGc5MXR0QXlCYU11RkowM0Urakh2azY0dw0KUHNXaTk3NWtTQU5iSTVQSTYzb3h4OXlFVThoU2tjcXJIRmhDQmNqRjhORDJsVldSY1FRaldCQ1djNzVEd2thbFVXL00vWTRhdWp5bg0KL2VkUTY0OGk2ZHdHcFZJZlN1YTh3M1ZDZnlOS2hENjFramZCOEVkcG1lalNWTkUzK05CVTg0VFJRMU0vdXdXL1QvR0VSTnFOZnZhMg0KZ2NQYkFwcnd4SXh0ZW9jcm9aWEdYNjl6YmlQWWlmb25GZXRUR0JGamQ4Y3NubTdkblJDd0NiMXd5WExDRnFLNGUvTGFkdHpvK3JaSw0KZXFzUkp6NEFxU2loSURGVlVoK0xrNXJWV2VjbFczSXhaYXY0OEc3UTVKS0F3a2RwM0x3Y0I4clJmaVlVWDlJdktnMkFEaVNJTmpaQQ0KdzkxYmRybjBRT1NLY3RCaFpLMENWR0s0a205ajhpcDVmaGpmTi9BQWRTVFkvUXExZk1RRHA4TXNMT1d4ckk2aUNOV2lzWUJDUWtYag0KZE11MUhmTnFxa2pTVzk4bTRKQnBoNnQvVnlrRUhTajJsQlpzdlYwWU5ON2tKdk12Tk9nTnNSV010UjhHU3hCSGNkTld4MkpOdFNULw0KbERIbENxd1FvMVk5eHRwQlk4RGNzM21Na2krY2lIMk9YZHRteVVmT2E0YlJ6QmVrU0xGZjVqdVZWcGh6V2ljQmZvdGZMQ2FWSjUvMg0KSWtRSlhyZzZCam1hOUxMbkxYaThZcXJmSTBiRjA0TklmY1NmaDF5aHhyNlN1YU9tL3MvVUpmQzRGdWhMWGlWbXhybWV1S204ZW1qMw0KamsxZzB5SVAzNTFCUWc1SHNhbVlXMTA4aVk0M0dqQmlPZjZvUUJHUGx6QW5Oa1M1S2ZiMUZRSENTb2VCV3hoLzNiTkI5WGNmUCtVVw0KaTJSN3BBaHErVy9HRC9kSmRSVkVaQU9KR0Vab2tYVDdhbVZ0cWE4TFVxK2crdUUwbDN6cTVDT0NGSkI3RGhxbk81b3c1L1RnTVZiWg0KWStPWlJRZ2gvaUo3VFB4SU0yb1VucjIrdHZuMmx5UmhuTUdKb2ZTc0pvbURhRE0ydFhRYXM1MjFQWStUN3ZGSlM3Y0ZidFJCeTBHUA0KOWplMWl2VmlBemNJTFMrUDdlcmozeFZ5OENwWW9SSDNtVmRJbU9KM3gvVW53QkxzY1FHTnRTUm5xeWxlV3dubXIrOHVJSUVoSlI3MA0KT1dVdFhhU3g0cGdMWDZuYXBNVytobWZvQW5pT0tISVAvdkNjRks4cHJjRGpwNGN1RlEwbkpDNWx5VHpXbnllMys5RkJUcGYyTGFqNw0KYXhmWlBuQ1ZIdGpvZ1NnMHk0OXJmR2hyZWloQU43MndnekRSemxqWGJVU0VTL1ZHU0JxR3VYb29pRG1WMWpScGg5UHYzQmRJU2s0Mw0KZzdPcE84TXo2eUpLSHcxRDhnZ1hVcm0xR01QSjZFb3kxV0czU3doa09qOFFyU25uOFpOa1pZODMvcXl1bStZTTZsN29TVnNSTXdVNw0KZ3pIRWp5TmVRbFJxYmoyNWEwTXI5T29Kd0ZjSGhhWURIc01MWWYxL3BuSzVsSk9KV01OS3R5MGJzT3RNbjBMUDVWK1JOMTNXY3NnVA0KT0FqSzZSY3RmY05tRTBla3R4cElnY3BUTEczWkxtYVZaUEtrTGFDcXEyUmc1cHFXbXN5K3lhd1VHK1RrU2h6OVlRU0JaYkZoL3p2Sw0Kdm9BU2tMZnFReVhCMDZ3T2lmdjg5SFV5amIzNTVHbmQvNUQzU3ZYUk9wTGtjRmVBVTJJamIwWVdkZ1JzVFBNeXY2aG5zbWhnVUQxbw0KSGxXM1ltcm9PdWVZTmRmRk91NmJkRlRGWmwydE0rblhHTXRPUzhBb2lCYXkyczBlOEVXZTV5TXVGc29OL1lzUEd0dEc2YjgxdkpKWQ0KOFloV2p2dS9wQ1l3MDRzOFRPTU1sNG9ubUxXVndmbUh4cXJwbGdGYkx2S2tDY0QvMzdMWExiL2JBRWFRcm83SURReVBNY3RReFMrWQ0Kd2d1V1dwcFoxdlpEYlhxK2NWTEFHRTBTSDI5ckgzU0M5c3BQVXd6SFBYM1MxOGdVRVIyejRqeHk2SWlXckFuczZmV3pVRFl3WG1BNg0KUTdEWnRKZmxZakpJK2NMbDNRY0JZdWc2MzFGR3ZUSjZ4NUJlOGFvRFROeXg1NW5VUVJraHY3SEFmcFl0cFlSUFpxN3NWQjhkQjRVMA0KMXVYUnVuSmk3Z0N6NzFtV1d5YlFyK3U0Y0VUd0YxK0hIbkhVc0crSno0MWJGQ2hhQXIrQUVqSFdPdkt4S21XZ2JuRnEzcHRUblY5MA0KQS8vVjRyNDI5YXlPd2FVNTcxdFV6MVVSWU5FR3dXKzRRSGxkd2hIQVdPRlY1c2hyanM4Y3R6elVtNk1FT0ZIeHhjcmx1bUxYcTdhaw0KZ0lFQk93U29wOXM3UlltZmJJd0kxbmlDUjJESkdKbHpHUTUzdGwxTE55VjBiOEFqZ1ZLZ3BCQzN2VjZMck95eTdndFVaZVpVUjEvdA0KYnN0QmdESXM2NmwrVDdZbSt3PT08L3hlbmM6Q2lwaGVyVmFsdWU+PC94ZW5jOkNpcGhlckRhdGE+PC94ZW5jOkVuY3J5cHRlZERhdGE+PC9uczI6RW5jcnlwdGVkQXNzZXJ0aW9uPjwvUmVzcG9uc2U+"
  WELLPOINT_SAML_RESPONSE = "PFJlc3BvbnNlIHhtbG5zPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIERlc3RpbmF0aW9uPSJodHRwczovL3d3dy5xYTEubXlmaXRvcmJpdC5jb20vc2FtbC9jb25zdW1lIiBJRD0iXzY2OTg1ZjE1NTIyZmI2MDYxY2Q3Mzk2ZTc3ZTZlYTc0MDMxNyIgSXNzdWVJbnN0YW50PSIyMDEyLTExLTI4VDIyOjM2OjEwWiIgVmVyc2lvbj0iMi4wIj4NCiAgICA8bnMxOklzc3VlciB4bWxuczpuczE9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5zYW1sLnVhdC5hbnRoZW0uY29tOkZpdE9yYml0PC9uczE6SXNzdWVyPg0KICAgIDxTdGF0dXM+DQogICAgICAgIDxTdGF0dXNDb2RlIFZhbHVlPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6c3RhdHVzOlN1Y2Nlc3MiLz4NCiAgICA8L1N0YXR1cz4NCiAgICANCjxuczI6RW5jcnlwdGVkQXNzZXJ0aW9uIHhtbG5zOm5zMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PHhlbmM6RW5jcnlwdGVkRGF0YSB4bWxuczp4ZW5jPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyMiIFR5cGU9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI0VsZW1lbnQiPjx4ZW5jOkVuY3J5cHRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyN0cmlwbGVkZXMtY2JjIi8+PGRzOktleUluZm8geG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPg0KPHhlbmM6RW5jcnlwdGVkS2V5IHhtbG5zOnhlbmM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jIyI+PHhlbmM6RW5jcnlwdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI3JzYS0xXzUiLz48eGVuYzpDaXBoZXJEYXRhPjx4ZW5jOkNpcGhlclZhbHVlPnc1VTNQb3B6ZVVkdndYajh2c2h5UFNmN0JxcUVqa0VBVzhkQk90VkZuOXU4aUdZZWRQMDllYTYyaEhVYzFqajNJWlA0Rnd4WVpyK3YNClZtc3pEK3RKOEZMYyswajFibHh4enRjcFZLYitBY3lEZHBQV3ZCcnE2MHZhbEZ2S3BhcWZrNkdHUHZ5eEQrV2o4TzVtWDVjRGRuSGINCndvMXh3R3VITUpyWk1PSVJTZ0U9PC94ZW5jOkNpcGhlclZhbHVlPjwveGVuYzpDaXBoZXJEYXRhPjwveGVuYzpFbmNyeXB0ZWRLZXk+PGRzOlg1MDlEYXRhPg0KPGRzOlg1MDlDZXJ0aWZpY2F0ZT4NCk1JSUNZekNDQWN3Q0NRQ0xRN1g5U1A4MGlEQU5CZ2txaGtpRzl3MEJBUVVGQURCMk1Rc3dDUVlEVlFRR0V3SlZVekVMTUFrR0ExVUUNCkNCTUNRMEV4RkRBU0JnTlZCQWNUQzB4dmN5QkJibWRsYkdWek1SSXdFQVlEVlFRS0V3bEdhWFJQY21KcGRDQXhGREFTQmdOVkJBc1QNCkMwVnVaMmx1WldWeWFXNW5NUm93R0FZRFZRUURFeEZ4WVM1dGVXWnBkRzl5WW1sMExtTnZiVEFlRncweE1qRXdNRGt5TXpRNU5UZGENCkZ3MHpNakV3TURReU16UTVOVGRhTUhZeEN6QUpCZ05WQkFZVEFsVlRNUXN3Q1FZRFZRUUlFd0pEUVRFVU1CSUdBMVVFQnhNTFRHOXoNCklFRnVaMlZzWlhNeEVqQVFCZ05WQkFvVENVWnBkRTl5WW1sMElERVVNQklHQTFVRUN4TUxSVzVuYVc1bFpYSnBibWN4R2pBWUJnTlYNCkJBTVRFWEZoTG0xNVptbDBiM0ppYVhRdVkyOXRNSUdmTUEwR0NTcUdTSWIzRFFFQkFRVUFBNEdOQURDQmlRS0JnUURXTXAzRWs3UnMNCmJLbWZIcVlSZVpTNmxCQlQ4NXMzaEhSK3d5blpFeUxvbHhCZ1I2WEFyTytDZGdMM3J2SmJZR2RvNFlIdjUzd2hvajdvZStMcnFFaFMNCnV0ZSsySlZnQ3pTWUt0aFM0MWpTcTVvV2kycTdkcHdYMmxhUkcrS1lWVzUrUWxDUW5UUmREd09nOHhEeGx5d1lXZkYySFlxRUhCdlkNCitYamk0d0ZGUndJREFRQUJNQTBHQ1NxR1NJYjNEUUVCQlFVQUE0R0JBR0FkVXZjejFHdGkwUzBpK0ZFYkFCTklOaW5NMTZrZTZaNFcNCkxKODVjU3dxMzhVOGZpelYxd0hVd1ZSbWVHTWwvRFFTaVlNVFAzNXJjNndYMTRwdUttNGhUWVNUUzZ5OGVSOTIvZDlJNm5BdVJoakkNCm9XUlJ5bVgrd1kvZTZ1ZW9iUDRUdmE0VEUrOWVQOVRPd0Nac1QxaGRCUnJ3Smw1MnN1cGpLR1p4WGVyQQ0KPC9kczpYNTA5Q2VydGlmaWNhdGU+DQo8L2RzOlg1MDlEYXRhPg0KPC9kczpLZXlJbmZvPjx4ZW5jOkNpcGhlckRhdGE+PHhlbmM6Q2lwaGVyVmFsdWU+bzNWbFRSTTQ1S0QzK3UrWEJwaGN2YUhoVU5aREcrS1VOVW9MU3RVd0w5QzdudENUcklLalJPdmVIOWFCNUthc3VJVEN1ditRZ2s3eg0KL3Y4VzMxTCtPZzhPL0VCN1VVNUlVaERmSXlueXhHaUdxY3g2dHZDdVBZLzNaeXI1bm5PaXRzVCt4UDE1dHJKTEVENmIxeU9zMGlNeg0KZytJdnBuQkFVKytaTzk1TklKVlpiQVVsQVFPY0gyNVBNaTFDOEdoUzZrYWdUa25uVmdrbVZSbnJ6ZjJGRTZLUlJuNXVuSm1jWmNGZQ0KZkxPMU9ycVh6ZHA5SGZ3RWFDRitCSGFhMDFzVlJlK2xybWpMc3ZDTDBXR0kyc053N2xxRjNKdEViSWNLRWRvS1o0NTRMQmxiem5TVg0KaGk5bFhBMW5ybEVxbEFSVFRkcjYyRTlDeGYxa3ZuTko5MlNSZ3ZiQ2VlYTM1N3NvWEtLc0RhTU9ZZ0kzaGR3YUtYNkpIM2MrVVhEQQ0KNzV5c0FpK0ZNemFQSWJ2RG9ZMUtCcDlUYUNOeE90L1p2QnNhK3dZZHZYVDZFRFlrM0owNUQrRFhCMUliSms4b1pHT2dObUVCaUhXMg0KbmJJSzFBdWVoQWkwQVZLWmdOMEZNb3RUN1V5Z0k0U1NNaDltUXk1YU5MRVlqS2pJb2hVWUswVzZTZzFSOG5LampjV3FSL1k0a3JuZQ0KdXVOaXhidVV2R0dZUzZSY3R3QWxVZ21BbHphQjMxNHRTRXo0dTg3MUE4MzhHQklkeXptcG9PclVucFZUQUNVZWMzbmdIVnBYK0tYVw0KTEhMQlU1ZEQzdCtQb29SNFk1M1dMMXlybzUrRG5SNjVYVmo2YkRIQXIyYUkzaThoSnlHY1Q5bkxoVEpqWUc3cGxxR0Vtd2hEbkR6Qw0KVTl5SGVHT3p5M1BDQ1p5b21zTC9xOHlsYU9mMmJ6a2FHdHZncVlrbENqc3ZENW9XK0J2djdlUFVmVnd3RlFlSDdwS2lKRytCWGZDMg0KT1VOM0lhOWNLZkFuSE5TeStiaU16TXhNVWVaS3dBMFpubE5icXArb045VHZsYzRzTDJiTHErZk5CQkdLVGhISFc2K2lpVlN1eW9QRQ0KR3R0TUhzeC9LRHBSc1p6VjJkblB0cHBkTWhxU0RBR1EwaFA5YnFUM1o2U082TEYxRWtUdW1jdXFma1Byd0ptYTh1SVFuY0FOMDBFMg0KTlZyVm1EUGlKdUFtVWdJSTNUbFZXbFdxQVhqYVFEVXVlVnlScCtkN2JyZEtqNFROS0pUZ1V1cDFpUGlFbTU0SStKV241NmRQTkJkMQ0KWVNZSCtnaUtjSUpUQWp5WU9SMmNPSWgrcXAxeUJwL2NQSCtsb0ttUUc2WEdDbTcvY2IxMmVxVUwyVmMxUzdFUDJrK1V2THdZL01xSQ0KWFE1QjZWS2RqU3BMMzE3c2RXbHQrTGxKdmtjcWI0QlMyM0MyeVFWaS9OdmVSa2JBK1BJQ1FQZWFyMVNyRHdaN2F5S1FyL0hoSUt5Tg0KQUMrc0NkL2NxV2EyLzNCeTV0WFR4TlBzYlNWVGZ6YkMrNEVjbmRUN2xITVRvN3BGbVhtQ0t1eUFJMHpnNnpJVkViY0tIUjlLY0JRag0Kakk4V3Jra0JoSW5pc1drR3ZsV3dKMFk0eGM1SC85eWVXRjZxR1U0Q2JPaTFIdEdRR0VZdC9zWVd2VEl0WHRKaVNpcmlHWFRYVm1GQw0KZndVOCtmRk5CS0FPS280cFZHNGdtQnk5MUIvUSs1MDc0WDA5MEQ2VVFWK0RjVUVmRzg4TmJ5eFgzWmtzcDFqM0dQU0pUYUt3cDNuaQ0KTmIzMnozaXk2ODAwdUtRVVBXT2ZwVlhLN29yQ3ZWZmh5SXpGcTMwcTRCcW01b2FITzVBbVE5akh2Yll3YTdlekllTm40bjlXQmVsUQ0KcHhkRTlsOWcrM3NoNUgyMVlHdzE1elpvK1lPams0QTlCbWRtbDJIWERxVkNSdTZpTUgxTmcvanJEYzljQ09vRGNWUDZZLzNNNlA2Tw0KdHNGdmhpSzdUQ0N4dE5IbEd6UTQwdy9xb1dxSTBCbERnTWJJOHlic29zVnI4Qk1aRnc4ZklvdmFVb05qRzExcUtwa3BzQ1pqNlc2Mw0KRlpxTEpXZEEyOHhVRUlCQVlDeEp6b1BpM0lhQlRzNlVYak1NdGx6c1BJYlVMUVptS2dQUGtrTFM0eXRyOEYrMG9VMWJMWHRHVnhoZg0KUXZ1bVA3TzQvbXJ4TEVJbFhiK014dlg4NDdGOGRBOHdHOUV0V25TZzhMc0w1UzhTNE9QaExnVEk1c3BKLyt4RHBEd2JZNXRCSk50Tg0KMWZRWEJmVVpQV05OVE00aG4zbG1qT0FtU2laN2tkRVdsUVE3TWNnTTg0bEcyVkdJeHJDV0d1QWZHRmkycXE5OW9sak5jRmZ3U25HNA0KYnZMbGRlbDdKYU1Tbmo2dEFwNEFwd1FGTlFrWUsycm9hTWgrSWc3TjN0Sy9Ud3pPSnpmS2JtaEhPMGxySWNiWGg5QlMvYkFSMFJrcw0KZFFlUlIwdE9CNDVSSGtualJQWFRvWjJHSEkvVE16VEg2OTJZaWVQQ3VyRXlJRGlpM0M0UDBGRkhBNWg1aGJzS0tydy9MSC9LWkhmdA0KanVoZGZmQXVhSTkyQ245aGVJV0lBRXJTTi9UYTZsSVRrMWlKa2ErQUtZdmxsdW1aVFFUNDk0SStjQUN6aGh1OXZtVFJxTVVRUkpRdw0KM29oMVovWXNZU3pURUtFQ1BoZysxTlp2c1BJTDB4cDc1Umx6bXhJNmoxdUZiVnJzcmVhckdiTmNqMktZN2l5SGp2UDRFMk9qNjB5OA0KQklKcDR1Y3F3U3NRaGJQQUV0VHo5eVZUa3RvNnhqTnZkSExmM0h0eG05aENTYk9oOS8vSlpiMEZSc25rYjc5UERCUmxuMk9TSjU2Yg0KQlM2OFIxN0NwVlZwNkY4bytmUGtBekxXTEJrZ2pzQVRlYjZlbTVKelVwY2dZSjFhbE5IVkQvbnhCVTRNMkZFRUxOckpZQlFpcStLSw0KMytqMjZsUExLclJJbXorYXc1UlJYNzViNXJWYytWTmN3SEtrTi9NOHNqZzc1L3k4dTMraGU1azNXVGY1UFNneWVPeDlLV3JRb2VDUw0KVERZZEtKTExlY3VUU3Vydm5EMzdDMGtqZG9VZzB6MHZiNjYvb1kwZXlrb0lXTlRmWVB4eFJXNXJ1WUEyV250em5uQzJZbzA2elQ5TQ0KR0JmZTJBR1JHbGxPb09DK1NVakVRMUdQUk5HTkhLVllWUk1jSUVRZkN6MDJsVnJNSk1hWndZcXdOVStUa2MzZ2pCenZsM2tVK1BlVQ0KalhISU9pc3RFRUFUZEVJK1VkV3lLeTBYa0pRQjFkSzdOdUtDOHYxcUMvSUhtWFIrTVdvNUI3YzJ1SEVwcFdvcW4rNm9USkwvaWJpZA0KY3FjMkZCQXRER3VHNDFLRGV2TDJWYk10bGltUnVKK3RlMm4yNTRlYi9Bai9SUlNMVlp1aG5FTWFYVVMrYzBNbDdxWlZwM0V6SDViLw0KeWV2cWZ4NWpaRUFlL2FMeDVXTFJCOHNoS3JJbVY3bjhSZEhKandVbEpqOFkzbWE0NkxnbGVEUGpWdkJEb1hZQndJVFEwNkMwSThlZA0KWHB1YUxzS202SVZGUElLam14eG1hYWIvb3RHSjlyWmwyaDZEREs1WmZJTmJzWTcwaWw1eUF4RkMxcU52dFBXN3ZaZklmWldzb1ZZWQ0KNWg3Wk0zMCtUZ2VodkpKVW80Mm83ak1aVnlEVEoxa3pLS3NRWUNXMGt6akJGNndxRU1uc3FPNnorM24vRXRyTW1WS0tyc1lDSldUbA0KQnZtMkRWUUtPSnBwMXplTU9majd5VUxha21ROUZnbDh6SDlPSHA2SENpOTNxb05na21jU2tZNHQxNmdHYldIbUpmdTBxYlFnQTUzYQ0KUlNOQUx1K0lCRDRzTmd0SExxQ2d2YndSK29iQlEyeFd5Q0lkRFVUaXF5bzZwNjRXWkRXbjh4YldWUGNJSjIvcENrdmFKcEgrRWs4aQ0KT2pCMUlIWG9uK3B4bUFCRzZQZDF0MmN1bWF0Y044MW5KeVk4SXJXclpIZ1RJaXZCdlhaQVZyc2ZKTFZsaXNWMTZhd1JGRHR3cmFDYQ0KdUxyV281UGIzTk04NDlzdXB2blI4M0xNbk9UcTF1bGxHNHpWV1BadzV6SVBuREo1M0RkU2NCdVlKWTAzSWhrRksrVjNrMENERXdORw0KYktxY2gxKzV5bkRkTm9LZTdXOUdaUmJycm1kRDhkUDNVejhEcFQxWWhUKzdhV1JHbm9TOUNVeDJ5d3JhaVVRak5aVGRuMHpVcGJYVQ0KMTl3TVBRc1dOczNtdU5SYXFJN3F3SU5OTGNxMVJIZlFSVjBncmY0bGt5aXJ2SFZleGJlZlYzMWRORkJ1MTNuVW45VXNQUVdoR0VTRg0KTnNSNk1xOGJkNjJ2bSttSDNNUnJFK3ArZ3poekhvZ1BBc29mQSs3OW1RT1VKY3Z4NmF4QWVRajVuYTh6aEhZL2xjcTJxVy9UQ2d1UQ0KbEp1MExKWnU2ZSs3SzBVRTlvdUdhMlJsbUE4Z05ZZGtENGNkNFdjQWRzTVI1bTh0ZmtGdzF3VkxieHcwdDdjY1FMYWNxWHNlbE5BLw0KZ1FhRGx5UjNuM2tIank2eC9jdE5rTUpibHhlYTVUSlVETkVJTVh3OXpOOGh3MXZtVHZDSGkyQnQ2SThCd0xqand2bUwrNkNtYVhaRw0KcHg0SnUvUk94S2RoWExESjVyQ2ZDNDZEcVVBRW8rd2hYam41WGhYdExMT3V4OFVoZnJlVVE1NDdFZk13VnNabVBmVlVYWk9YUlp3Uw0KcmIxR3NJblJiMXlKc0EzUG8zMnJtUW40RnNCVnFTN1F1WmFNbmd0MkVGMkxjR3RmSGJ2czZxd0RtZlB4d0NTbWF3TVlMYStGbXJYdw0KMHY4WmZaaVN5T3ZsNnM4djh5OC9Fbk0ranJFNjFoNWRqdHlFTVJkU1IzakdzUzkzdGlyYjVSNko0bDBMSEFvSnp4UWxlNFo4bGUyUg0KSjBpLzNmT3dFR0NXM014aWxvQjVDblZnMjAyTXFzWXhWYlp1cGhScDNNdFgzY2VRSzhvK0FvaFV2aGNjTXhZOWpieStXWk1KVS9RZA0KOExYOCtobHhDZU1PVzNQRm5xdXErMWx4UXBaUUlVYUd6a1h4TEMvUWdISVI4eGp2emo0cURzZGw4VnJTbGcwdC9jNGVXTXdvbUZjWQ0KSXFaajg2Q1lvMTFKb1p2RktJSUJ0aWJuZmdsTFRYZFlkR0Y1QlBLZEZXRDBLYzVXdzdSUHVlWU1aU3A1NEJBL2c4Z2lma1JabGFPVA0KV0RzMk1aNU84UjVoUnlkSXhSRC9CMlZqN0VzVGVaN0hyTlFrOFJSUW5yMGxwY0pJRW5vbUtuME5zcjFndDVxcWNWN1lHZWhOUlU1dw0KVWNpc3VhNFJsdG14aU9UQlV0TFFjaU52UVlid1RBcHpsTTNWaTJKTThoOGk4Zjh2NTA1cThHK2hOdmRRa2JaWUZWeUtSR0FxV29Rdw0KeXJTMXVRSzhjV0xDYkV2QTN4dWorSmZid2VFWjF0dVlPR0w1VnErdkQrMHhSRnkzSWdtOWRublJKdlBJK2xIQm1jSkQ4V1J5Q1F4UQ0KRVZ2K3NWUmJSYkF5OTZNb2JvVHRmRjgzWHNjRkYyR3grZlVZdThtbXhPcG9ubmZlUkFPK3R2M2s3MTc4NmF6TVQza0V4STIrMFlWZA0KRnBZWHNuWjhLcFhYZmRvVTJSSUtBbEJPWjN6ZXBoUFNuM1VKUFRueDJyTktFODJqMzJtc05ZTmhRMVREOXVrWnkvcG1BSkxYYW1SbA0KTXFveWdsc3dySzR2U1BjRnpaN29Id3hEclIrR3hVeEtPQjdmbWpsUmJrSzlVQldVdkFrbDY3SmJLSHNSUXQxcWN3Qk51Z2RkWkFDRw0KNHZuSjZHTldsUFc4YUpkaGpQS3JlMnBoa2tCeU5Hc0Y4WVlEZmxlRlBtd3ZBdVV2MGxNQnpVMHU3bmV1UTAzdzltTkJaczFCVXJUbw0Kb0diQkR2VDhVNEJZMzVQSWpmWGQ3TGZvcXdjNUMrdTBQcnA0clcwQkJ0UE9lNklWaG1ZcUY5ZTlPMm41UExBRm9mVElsaVlVYm53UQ0KU0w2YWh0MTVId1ZqZUhKZWRxS3p0STF6YlZIYzVGd01iaEhXMk9YZUY2RWJoY1FaK3d2b2lJVnJVOGtLU3BUN0F3VXU4RTNiWllydQ0KTTBpSzVZbFB6UStZdmZXYTdHMUh0Uk5TWkh5RHJWSkZWeEtFNUkxMG1HSEFVWnk0RnlyU3NKMFRxUEd5Z1ZnRkpJUGtrV3VYTlBjRA0KY1dERjlVTHp6UjNuR05PWUcyTVo5L1FuSDRxaXhjZlpaMEZld0dVblRpT3FOaVF1aDRSN0JLUHROczhEbjRhMndkMnZsVFhQZEZvUg0KMk1TMUJVc1hwbDZLQVNKMHNhRDVzRm82SVBDOXFWTjhuQUJ3T3RLbUV3T1FJQmJ3MDAwMHdXdmJ4WjhleFd4T2NRYVMyOTBEWFBmNQ0KSXJlTDFRS0RMbThHRmx4ZnVWUkxhUkp1N2FXK1pUSlRvd1oyR29LR0I4S1d4dmdsOWMvTjdRbGVzWDljd0VXSGZQQTRmNkhwUnB5eg0KUGFiZW0weDRTYmc2OUlVS05kWVVERm5SeXdTNXlqL1d1V1RxNXdGTENUQ1U1dHNXT1pBa2lNZUFRQk1hR3dJSzA5Z2pXM09lcGt5Zg0KaXR5bHpKSXZRbklhQmlQYzF6TDNCTHh6bjQxbkhaa0YvUm5GR3RRTkVYajZ6N3ZvTGlKd0VwejBJbjVhSzdVTlJ2NXdxdGR6WXE4ZA0KeTlrb2pVNWNJSEhIa2ZXUGp6NjBmMi9taFhNYmxnNmVPQnlqQzVDTlpQOGpMMzBTeHdWSTJValM1ZXdtaWNDMk54RnhsUlFyV3UvNQ0KTGVEc2txeG9PSXlvU2VaRGoxQy9Wbkg4TWdOR001N25ReFc5R1dJdTlLUFdLdHhLM0Zaa3RJWmVnRC9tQ1hxUUY1dU1sWGJjYjNCMw0KVUNXMVFUR3BkUXZCOGFtVDI5OExTV243cHF0N3VXNVY0cFYvNkY0OUdLZ3FYVmNzcGhPYnlwMUxZTDlTd2x2dkxSdXpMU0JsaWxVZg0KQldSVm0yTWdNWG14cEZrUG9ac01aRlJYWW8wK3p0R01XekJiZlFnQlNKQy9aYUx4Vk9NcUpEcVlwd3dob2U1TjNKK0RvazZmTERpNw0KTUVPS0g2SllxeDhDaGN6VkwrS0MvWmdEcWdNNFo3czNwYXlDaEsvbEE3cTF6UmpmOWQ1Ky9BbXBiOE5YdUdZVE43b01vVVVNdHBHVQ0Kc01YWEJZb0kxaGFRZ2VqaXFzRGVObXJPZGx5VXl6RExPNUtibElkUnRPSWpuWS9MMFNCOUcrMytVSHN0WVpnRWpuSGFxc0JXUmVUYQ0KaGw5Y2IzR0k5RU9CQy9wUzhJK3o1UGJ2b25xd3pVVFUyRzFNRlpJckcxZEJrczJ0bnBDNU8wRjNWZ2V3aFdQMjB4OFp3NHM2OHkrcg0KVktKUGpnY1ZONVVabE43KytBNUJmWmNTZUpiWUxGN3d0TUYzb2hYR2ZSdDlNS2l5SmwrNmJqc2tTQkFMd1dIaG1GbHpPbXlqWDZUYQ0KVXRhZmlNSy9xL3l2SWtJa2JxNVN1UWh1OThqRnc1ajBMcEZwVy9lSDk3NC9lam5SWEdXY3ozVWxpWUZ2MkIzczliei91VTBURzJGNQ0KSVBBcUNKSXRiSmdocHZSZHVUcVFWelJ4WlIzYUtpUG9GanF4U2V1RmwzWkExWHFxWEw0dXdsM2t1Z2JPQnNzTEV3VEdWYjk4YlhKWg0KYmVLN2V5T2xqcXRNS1dlSlF1alpUcTE0WGdqcDNQT05lUzRaZXdKTkdoSjFpQnlhTFhoc2Q4NGg3eldZYWVOT2kwNndhejY2RXUxRw0KdWEwZHQxOEFucVhTSytlcFRhd3l6WitxSlpUQ0dFbnIxb0tjSGZBcTFrZC80YnkyT2gxTkVxby9mRU5GOGpGcmVVemVrdmhQMnQ1Yg0KTDhKajlScm5JeDRETXFBT1BHM2thcndndnlVOStwM0hSNzRNTVlVeittdWpJMEIxNUdNT1haTGd6KzE5VS9DaWtVOGtxV2MzQm4zcg0KSHp3SzF1UFd6QlYxaG1ZdjQ2M0xGMXdSUlBwNVV1RGZwaEEySGpnSnhyTktQMzlnTXpJcnRlUXFHT2RGQUIvVVB5TmhNQUxJZVVtZQ0KRzJTQ1B6bllRU3JNQU5GRTFZN3VoVWFScHZteHNBazBqV2FPa04xWlBKMFczUWxNZklLQ3hYNUJJWmlGUmVpN2RqMjI4TDk1S25vSg0Kb0Fabzg0Y2hUUSt2a3JpKzhYdnQrYmtuUnBaVWtHY2xHVDRMUDg1b1BtRjFlSWwvSEN4SGgzZ0dscEZwY2g2R2FPa3lENzFxdjV4SQ0KOXNBUU9HU3piYWJmN25nMll6dncySUc5cFFXWEdwNVZNeldvM2pqQWVubTJiOVBFSXp5aE5qdmhaZjh3V2JXZnV3c1NIS2FCdDZhaw0Ka0FCaTNqQnhrQ3FITlRycTY0V0JJbjlsNk92cXc0L3hzb0ZmUlM3c0wra0JkMmZ2cjQwQVZtem1FM3ZhOGtMSzR4V1hqYU1UOEJVQQ0KdERBUDhtTitNZHExS1RtajFmemRqLzN5WUxoNzBvSU5lZkZLS01xbVVnZVFpYS9vbFh0Zmw2OW5qRmx6elZGQVlCci83UkZnUEVNNg0KeENwQXMzcWQyY0QyMVJZYTVuYys4SmNRRDg4bk95TC9JUHFORkpBMDhqZDh4MVBZNE5VS3FDOFVHT01UMVBkKzZvWGZNM2lJZUViQQ0KS0JjY0lpTFE3Q3M1WVJMMDV4WStNUWVRNnlnRGdVM3pGbzZtWHdGanFPU3AvWktZcFVoYk9OT3VlbzIrdHpDYmE4V1F5di9iVk80Zg0KWjZJeEZvVUFzcnd4dFZTa2s2NUtJTzdZckhOcHQrSmdya1Z6R01iby9sU1liVndWYjZWMDF3ZHRiSVA4VVJ0ZjZDUkU3N0plRkwyaQ0KVUtjcVI0cUd3SEw3UU5ucjRjQk5tZGtya242TG84ZEk5YWxjTmpSWHNEc2tBUTVHWW1WbzNoWkZZMk92YU9VTVkvSzhIR1lHcnlXcw0KT2ZZNjdSUEhsb1dZUXNsS1dBSkIySjlWS0hFakN2MTgydVBjVHRiZUwrdGQ2NVF4eEdsNWxNUkV4SGlOUFVkTmdacmNNT3Q4ZjI4VQ0KQnpBdmEzRnhDMzdqSXJtVmEwdlJLekF6UkxjTUdtNjdXcXZ6N29XTDhtenM3dDVOalp2MGhMVmZNVlRQci9aaStTdXdNYjlqNk5ldQ0KN1FCTWR5L290ZG9EZlNHS0s0dXRIUjgyWlF1RHZjVXJIdEJ5N2FkVENzb3BZU3BFaFNhR0l2RC9xdDZrNUUwODNGK0NKNnZhZlcraA0KM0lOZjBzaWdybWc1T1JmcTVBSmxCa1BoU2NXcnhOMHNKY1FweTcxTGl1OGhaYmNncnRiTkJrZ1NsWldMSE9wV1o1TVBUMGNTYzZuaQ0KeEwydTIvOHF5emR6NnpBSk05dWJxUVQySVd2YjZ0VHdPM0ZVMUxCRXVrWTgrcGF4eFIyRFFiUFBpOTNGWGFSbXdKN2dTdEVtQnJXVg0KaDZ1bkExR1dqcWJWMzdNRC8rRzFhWjRYWjM1NWlWclFwVGM0c2FpeWlhSW1XMFZ5SzVqdGRySEJNYVR1NXRlMFJ0S080QWd3TE5YeA0KY2MyYXB0ZTJyeXljdTNpS29zQVkyVjkvT2loT0NldUh4UGVXN2djT2wrNGtwSUt6Q05SRVdyMlZxeU9pSmJyMldMNGRBNmN3RDVENg0KcGZYMHJheUlxcmduLzB3SmZrcGcxTHNBQkJXUFdKVG9EaGNqYTRvNGlHaHJkbXhaRDQ3T0JmNEluaE5XNUlxZm5QMHo4OEJoVk15Yg0KNExyaEh5ektoVkFlVENMRm5FYUczTm1nNXpOeWEyN0hHZ295c2hKRi9LRXJGZ3VqWVkvSjREQTN5azQ3R1ljSTV5SU8vcVN3QU4rOQ0KTmNheEg4cGo5VHJseFdsaThIekFVb1pUUGw4NU9TMWY0NlNoQzVkbUlMWFdJdzVsSkNkT2ZHeVRndzl2ak40Z1liazJhUHR6OEtjcg0KbUhGQ2p5MFFXeE9nRzdBLy9UUWEwNFIrM21QTlVRNmptUis0cEs2d2RFQi82UWRuWVpUUi9oNll6MmtYb2UzRzdPVnl4ZUgvVS9oWA0KK1U4QitGM2JwODd5d2R2NHBuSXM1T0I1ZWZEQ0JFMmxhY0QxYlppekJ6VVNxN3BxcEpGRXRvN2VKakp2SE1DUVBZVEdWand1MXhxbw0KRTczSFRzeGJhZU14MUNFbFpJTWJ4THBkVlBkU0xnVFFxb2YvKzg0U0lyNmZ6TGVBdXl2RGFRRm9Jc3FpMTNsc3M5cXBPVm1JUDJycw0KejlsdEFFRFVYeU1XZlBrNU04MVErNEN4ck5lNUJUV1lUTjhKczVNaEsxcm5hU1hBRkdvcGxObndpUVdMNXVwYXV1SE41SHZFLy9HRA0KUlBTZ1NKZHZRKzZjZ1dZTjVwKzRHRERVTTJmN3ZSOXk4RkNFRjJUanZjdW93dG5MZjBkTklvNTNpMnhmVW56eHRSZndjVjdJNjZjRQ0KdVVqZWVBaU1vVk1aemRNSDdVRjUwN1MxZjF2Wi9RTllnWlNPNXpyK0hFeFVVZDBYak1FTitsZzcwVTF4S3RWWDh1ejk1ZWpBYVg4RA0KSlJnb0tWUGxGOEpwS2pyUWhZaDRaYndGZHF1RHRRZDdWb0t3cHBqVjFhMzBjM2NlZUVKZlhQV3BBcUNLYVh6VmN4aVdObkRWc1FPVg0KMUpsWFZ0Q1NMRkNZVk5STnpZTnRMSjFLc01BVHdVb29GZE13ZmlPN1lNbUc5aHdIVUVlM0ZaWmZqMytrMVViUmNHa0oyeGNCKzhpUw0KZDNBUmMxUzJKSEtsYUgwNUdYNWEyeVp1RUFlZ2VuVjBhNUMvV3d1ZFJCaTAzeFdpa2R3ejNkTUNhK3lFbFRUd2ZFb0o8L3hlbmM6Q2lwaGVyVmFsdWU+PC94ZW5jOkNpcGhlckRhdGE+PC94ZW5jOkVuY3J5cHRlZERhdGE+PC9uczI6RW5jcnlwdGVkQXNzZXJ0aW9uPjwvUmVzcG9uc2U+"
  
  def new
  end

  def create
    if params[:id]
      @user = WellpointUser.find_by_id(params[:id])
      @saml_response = new_encode_SAMLResponse(@user.id, {issuer_uri: params[:issuer]}, get_custom_attributes(@user))
    else
      @user = WellpointUser.first
      @saml_response = WELLPOINT_SAML_RESPONSE 
    end

    render :action => 'new' if @user.nil?

    render :action => 'response'
  end

  def new_encode_SAMLResponse(nameID, opts = {}, custom_attributes = "")
    now = Time.now.utc
    response_id, reference_id = UUID.generate, UUID.generate
    audience_uri = opts[:audience_uri] || saml_acs_url[/^(.*?\/\/.*?\/)/, 1]
    issuer_uri = opts[:issuer_uri] || (defined?(request) && request.url) || "http://example.com"

    assertion = %[<ns2:Assertion xmlns:ns2="urn:oasis:names:tc:SAML:2.0:assertion" ID="_#{reference_id}" IssueInstant="#{now.iso8601}" Version="2.0"><ns2:Issuer>#{issuer_uri}</ns2:Issuer><ns2:Subject><ns2:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:transient">#{nameID}</ns2:NameID><ns2:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer"><ns2:SubjectConfirmationData InResponseTo="#{@saml_request_id}" NotOnOrAfter="#{(now+3*60).iso8601}" Recipient="#{@saml_acs_url}"></ns2:SubjectConfirmationData></ns2:SubjectConfirmation></ns2:Subject><ns2:Conditions NotBefore="#{(now-5).iso8601}" NotOnOrAfter="#{(now+60*60).iso8601}"><ns2:AudienceRestriction><ns2:Audience>#{audience_uri}</ns2:Audience></ns2:AudienceRestriction></ns2:Conditions><ns2:AuthnStatement AuthnInstant="#{now.iso8601}" SessionIndex="_#{reference_id}"><ns2:AuthnContext><ns2:AuthnContextClassRef>urn:federation:authentication:windows</ns2:AuthnContextClassRef></ns2:AuthnContext></ns2:AuthnStatement><ns2:AttributeStatement><ns2:Attribute Name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"><ns2:AttributeValue>#{nameID}</ns2:AttributeValue></ns2:Attribute>#{custom_attributes}</ns2:AttributeStatement></ns2:Assertion>]

    digest_value = Base64.encode64(algorithm.digest(assertion)).gsub(/\n/, '')

    signed_info = %[<ds:SignedInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"><ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"></ds:CanonicalizationMethod><ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-#{algorithm_name}"></ds:SignatureMethod><ds:Reference URI="#_#{reference_id}"><ds:Transforms><ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"></ds:Transform><ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig##{algorithm_name}"></ds:DigestMethod><ds:DigestValue>#{digest_value}</ds:DigestValue></ds:Reference></ds:SignedInfo>]

    signature_value = sign(signed_info).gsub(/\n/, '')

    signature = %[<ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">#{signed_info}<ds:SignatureValue>#{signature_value}</ds:SignatureValue><KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"><ds:X509Data><ds:X509Certificate>#{self.x509_certificate}</ds:X509Certificate></ds:X509Data></KeyInfo></ds:Signature>]

    assertion_and_signature = assertion.sub(/ns2:Issuer\>\<ns2:Subject/, "ns2:Issuer>#{signature}<ns2:Subject")

    xml = %[<Response ID="_#{response_id}" Version="2.0" IssueInstant="#{now.iso8601}" Destination="#{@saml_acs_url}" Consent="urn:oasis:names:tc:SAML:2.0:consent:unspecified" InResponseTo="#{@saml_request_id}" xmlns="urn:oasis:names:tc:SAML:2.0:protocol"><ns1:Issuer xmlns:ns1="urn:oasis:names:tc:SAML:2.0:assertion">#{issuer_uri}</ns1:Issuer><Status><StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success" /></Status>#{assertion_and_signature}</Response>]

    Base64.encode64(xml)
  end

  private 

    def get_custom_attributes(user)
      attributes = [
        { name: 'SBSCRBR_ID',   value: user.hc_id.to_s },
        { name: 'MBR_SQNC_NBR', value: user.mbr_sqnc_nbr.to_s }
      ]

      attribute_statement = ''
      if attributes.count > 0
        attributes.each do |a|
          attribute_statement += %[<ns2:Attribute Name="#{a[:name]}" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic"><ns2:AttributeValue>#{a[:value]}</ns2:AttributeValue></ns2:Attribute>] 
        end
        attribute_statement
      end

      return attribute_statement
    end

end